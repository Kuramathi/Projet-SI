<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
</head>

<body>
<main>
    <form onsubmit="return sendForm(this);">
        <div>
            <label for="string">Chaine chiffrée</label>
            <textarea type="text" id="string" name="hashed-string"></textarea>
        </div>

        <div>
            <label>Méthode :</label>
            <select name="hash-method">
                <option value="0">Raw-SHA256</option>
                <option value="1">Raw-SHA1</option>
                <option value="2">Raw-MD5</option>
                <option value="3">bcrypt</option>
                <option value="4">mysql</option>
            </select>
        </div>

        <div class="button">
            <button type="submit">Soumettre</button>
        </div>
    </form>

    <div id="output"></div>
</main>

<script>
    // Create and open WebSocket
    const socket = new WebSocket("ws://localhost:8080/websocket");
    const output = document.getElementById('output');

    // Send form
    function sendForm(form) {
        const formData = new FormData(form);
        const data = {
            chaine: formData.get('hashed-string'),
            method: formData.get('hash-method'),
        }

        output.innerText = '';

        socket.send(JSON.stringify(data)) // Envoi des données via websocket

        return false;
    }

    // On socket opened
    socket.onopen = function (event) {
        //socket.send('dir');
    }

    // On message received
    socket.onmessage = function (event) {
        event.data.text().then((text) => {
            // Add text on page
            output.innerText += text;
            console.log(text);
        });
    }
</script>
</body>
</html>